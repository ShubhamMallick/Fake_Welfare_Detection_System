<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fraud Detection Pipeline - Prayatna</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* ---------- GLOBAL ---------- */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
}

/* ---------- NAVBAR ---------- */
.navbar {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(14px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.nav-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
}

.logo {
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
}

.nav-links {
    display: flex;
    gap: 20px;
}

.nav-links a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: #667eea;
}

/* ---------- MAIN CONTENT ---------- */
main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 24px;
}

.section {
    background: rgba(255,255,255,0.95);
    animation-delay: .2s;
}
@keyframes zoomIn { to { opacity:1; transform: scale(1); } }

/* ---------- INPUT + BUTTON ---------- */
input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    font-size: 15px;
}

button {
    background: linear-gradient(45deg,#ff9a56,#fb2d62);
    color: white;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: .3s;
}
button:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 8px 25px rgba(255,90,120,0.5);
}

/* ---------- SECTIONS ---------- */
.section {
    margin-top: 25px;
    padding: 20px;
    border-radius: 12px;
    background: #f7f9fc;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);

    opacity: 0;
    transform: translateY(30px);
    animation: sectionFade .8s ease forwards;
}
@keyframes sectionFade {
    to { opacity:1; transform: translateY(0); }
}

/* ---------- FEATURES GRID ---------- */
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 15px;
}

.feature-card {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: .3s;
}
.feature-card:hover {
    transform: translateY(-5px);
}

/* ---------- LOADING ---------- */
.loading {
    text-align: center;
    font-weight: bold;
    color: #fb2d62;
    animation: pulse 1s infinite;
}
@keyframes pulse {
    0%,100% { opacity:1; }
    50% { opacity:.4; }
}

.error { color: red; }
</style>
</head>

<body>

<nav class="navbar">
<div class="nav-container">
<div class="logo"><i class="fas fa-shield-alt"></i> Prayatna</div>
<div class="nav-links">
<a href="/" class="nav-item">Home</a>
<a href="/dashboard" class="nav-item">Dashboard</a>
<a href="/pipeline-page" class="nav-item active">Pipeline</a>
<a href="/agentic" class="nav-item">Agentic AI</a>
</div>
</div>
</nav>

<main>

<h1>Fraud Detection Pipeline</h1>

<section class="intro">
    <h2>Overview</h2>
    <p>The Fraud Detection Pipeline is a comprehensive analytical tool designed to perform end-to-end fraud assessment on beneficiary data extracted from PDF documents. By integrating multiple AI-powered modules, it provides a holistic evaluation of potential fraudulent activities in welfare distribution systems.</p>

    <h2>Process Flow</h2>
    <ol>
        <li><i class="fas fa-file-upload"></i> <strong>Document Upload:</strong> Upload a PDF containing beneficiary information for analysis.</li>
        <li><i class="fas fa-brain"></i> <strong>Natural Language Processing (NLP):</strong> Extract and process key features from unstructured text data.</li>
        <li><i class="fas fa-chart-line"></i> <strong>Anomaly Detection:</strong> Identify statistical outliers and irregular patterns in transaction data.</li>
        <li><i class="fas fa-copy"></i> <strong>Duplicate Detection:</strong> Scan for identical or highly similar beneficiary records.</li>
        <li><i class="fas fa-network-wired"></i> <strong>Fraud Network Analysis:</strong> Examine relational networks to uncover organized fraud schemes and influential entities.</li>
    </ol>

    <h2>Requirements & Tips</h2>
    <ul>
        <li><strong>Document Format:</strong> Ensure the PDF includes structured beneficiary data such as names, addresses, and transaction amounts for optimal analysis.</li>
        <li><strong>Processing Time:</strong> Analysis duration varies based on document complexity and size; typically completes within seconds.</li>
        <li><strong>Output:</strong> Results are presented in categorized sections with detailed feature extractions for transparent review.</li>
    </ul>
</section>

<label for="pdfFile">Select PDF Document</label>
<input type="file" id="pdfFile" accept=".pdf">
<button onclick="runBasicPipeline()">Run Basic Pipeline</button>

<div id="result"></div>

</main>

<footer>
    2026 Prayatna Fraud Detection System
</footer>

<script>
function formatValue(v){
 if(v==null) return "‚Äî";
 if(typeof v==="object") return JSON.stringify(v,null,1);
 return v;
}

function renderFeatures(features){
 if(!features) return "<p>No data</p>";

 let html=`<div class="features-grid">`;
 for(const [k,v] of Object.entries(features)){
  html+=`<div class="feature-card">
           <h4>${k.replace(/_/g," ")}</h4>
           <p>${formatValue(v)}</p>
         </div>`;
 }
 html+="</div>";
 return html;
}

function renderSection(title,data){
 if(title === "ü§ñ Agentic Reasoning" && data && typeof data === 'object'){
  let html=`<div class="section">
          <h2><i class="fas fa-brain"></i> ${title}</h2>`;

  if(data.explanation){
   html += '<h3>AI Explanation</h3>';
   if(typeof data.explanation === 'object'){
    html += '<p><strong>Summary:</strong> ' + String(data.explanation.summary || '') + '</p>';
    if(data.explanation.key_points && data.explanation.key_points.length > 0){
     html += '<ul>';
     data.explanation.key_points.forEach(point => {
      html += '<li>' + String(point) + '</li>';
     });
     html += '</ul>';
    }
   } else {
    html += '<p>' + String(data.explanation) + '</p>';
   }
  }

  if(data.audit_summary){
   html += '<h3>Audit Summary</h3>';
   if(typeof data.audit_summary === 'object'){
    if(data.audit_summary.case_overview){
     html += '<p><strong>Case Overview:</strong> ' + String(data.audit_summary.case_overview) + '</p>';
    }
    if(data.audit_summary.key_fraud_indicators && data.audit_summary.key_fraud_indicators.length > 0){
     html += '<p><strong>Key Fraud Indicators:</strong></p><ul>';
     data.audit_summary.key_fraud_indicators.forEach(indicator => {
      html += '<li>' + String(indicator) + '</li>';
     });
     html += '</ul>';
    }
    if(data.audit_summary.evidence_summary){
     html += '<p><strong>Evidence Summary:</strong> ' + String(data.audit_summary.evidence_summary) + '</p>';
    }
    if(data.audit_summary.recommended_action){
     html += '<p><strong>Recommended Action:</strong> ' + String(data.audit_summary.recommended_action) + '</p>';
    }
   } else {
    html += '<p>' + String(data.audit_summary) + '</p>';
   }
  }

  html += '</div>';
  return html;
 } else if(title.includes('NLP')) {
  return `<div class="section">
          <h2><i class="fas fa-file-alt"></i> ${title}</h2>
          <div class="nlp-horizontal">
            ${Object.entries(data).map(([k,v]) => `<span><strong>${k.replace(/_/g," ")}:</strong> ${formatValue(v)}</span>`).join(' | ')}
          </div>
        </div>`;
 } else {
  let icon = 'file-alt';
  if(title.includes('Anomaly')) icon = 'chart-line';
  else if(title.includes('Duplicate')) icon = 'copy';
  else if(title.includes('Fraud')) icon = 'network-wired';
  return `<div class="section">
          <h2><i class="fas fa-${icon}"></i> ${title}</h2>
          ${renderFeatures(data)}
        </div>`;
 }
}

async function runBasicPipeline(){
 const file=document.getElementById("pdfFile").files[0];
 const resultDiv=document.getElementById("result");

 if(!file){ alert("Select a PDF"); return; }

 const fd=new FormData();
 fd.append("file",file);

 resultDiv.innerHTML=`<p class="loading">Running basic fraud detection pipeline...</p>`;

 try{
  const res=await fetch("/pipeline-basic",{method:"POST",body:fd});
  const data=await res.json();

  let html="";
  html+=renderSection("üìÑ NLP Extraction",data.nlp_extraction);
  html+=renderSection("üìä Anomaly Detection",data.anomaly_detection);
  html+=renderSection("üîÅ Duplicate Detection",data.duplicate_detection);
  html+=renderSection("üï∏ Fraud Network Analysis",data.fraud_network_analysis);
  html+=`<button onclick='runAgentic(${JSON.stringify(data).replace(/'/g, "\\'")})'>Run Agentic Reasoning</button>`;

  resultDiv.innerHTML=html;

 }catch(err){
  resultDiv.innerHTML=`<p class="error">${err.message}</p>`;
 }
}

async function runAgentic(basicData){
 const resultDiv=document.getElementById("result");

 // Append loading for agentic
 resultDiv.innerHTML += `<p class="loading">Running agentic reasoning...</p>`;

 try{
  const res=await fetch("/admin-decision/agentic-reasoning/analyze",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify(basicData)
  });
  const data=await res.json();

  // Remove loading and add agentic section
  resultDiv.innerHTML = resultDiv.innerHTML.replace(/<p class="loading">Running agentic reasoning\.\.\.<\/p>$/, '');
  resultDiv.innerHTML += renderSection("ü§ñ Agentic Reasoning",data);

 }catch(err){
  resultDiv.innerHTML += `<p class="error">${err.message}</p>`;
 }
}
</script>

</body>
</html>
