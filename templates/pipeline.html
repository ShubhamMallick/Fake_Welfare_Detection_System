<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fraud Detection Pipeline - Prayatna</title>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #ff9a56, #fb2d62);
    min-height: 100vh;
}

header {
    text-align: center;
    color: white;
}

main {
    max-width: 1100px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
}

button {
    background: linear-gradient(45deg,#ff9a56,#fb2d62);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
}

button:hover { opacity: 0.9; }

.section {
    margin-top: 25px;
    padding: 20px;
    border-radius: 12px;
    background: #f7f9fc;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    animation: fadeIn 1s ease-in;
}

.section h2 {
    margin-top: 0;
    color: #fb2d62;
    animation: slideIn 0.8s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(-30px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    animation: fadeIn 1.5s ease-in;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
    transition: background 0.3s ease;
}

th { background: #ffe3ec; }

td:hover {
    background: #ffe3ec;
}

.loading {
    text-align: center;
    font-weight: bold;
    color: #fb2d62;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.error {
    color: red;
    font-weight: bold;
    animation: shake 0.5s;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}
</style>
</head>

<body>

<header>
    <h1>Fraud Detection Pipeline</h1>
    <p>Upload a PDF ‚Üí NLP ‚Üí Anomaly ‚Üí Duplicate ‚Üí Fraud Network</p>
</header>

<main>

<label>Select PDF</label>
<input type="file" id="pdfFile" accept=".pdf">
<button onclick="runPipeline()">Run Pipeline</button>

<div id="result"></div>

</main>

<script>
function renderTable(obj) {
    if (!obj || typeof obj !== "object") return "<p>No data</p>";

    let rows = Object.entries(obj).map(
        ([key, value]) =>
            `<tr><th>${key}</th><td>${typeof value === "object"
                ? JSON.stringify(value)
                : value}</td></tr>`
    ).join("");

    return `<table>${rows}</table>`;
}

function renderSection(title, data) {
    return `
        <div class="section">
            <h2>${title}</h2>
            ${renderTable(data)}
        </div>
    `;
}

async function runPipeline() {
    const fileInput = document.getElementById("pdfFile");
    const resultDiv = document.getElementById("result");

    if (!fileInput.files.length) {
        alert("Please select a PDF file");
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    resultDiv.innerHTML = `<p class="loading">Running fraud detection pipeline...</p>`;

    try {
        const response = await fetch("/pipeline", {
            method: "POST",
            body: formData
        });

        if (!response.ok) throw new Error("Server error " + response.status);

        const data = await response.json();

        let html = "";
        html += renderSection("üìÑ NLP Extraction", data.nlp_extraction);
        html += renderSection("üìä Anomaly Detection", data.anomaly_detection);
        html += renderSection("üîÅ Duplicate Detection", data.duplicate_detection);
        html += renderSection("üï∏ Fraud Network Analysis", data.fraud_network_analysis);

        resultDiv.innerHTML = html;

    } catch (err) {
        resultDiv.innerHTML = `<p class="error">Error: ${err.message}</p>`;
    }
}
</script>

</body>
</html>
