<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection Pipeline - Prayatna</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #10b981;
        --accent: #8b5cf6;
        --danger: #ef4444;
        --warning: #f59e0b;
        --success: #10b981;
        --dark: #1e1b4b;
        --light: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-700: #334155;
        
        --glow: 0 0 15px rgba(99, 102, 241, 0.3);
        --glow-hover: 0 0 25px rgba(99, 102, 241, 0.5);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        background: linear-gradient(135deg, #f0f4ff 0%, #f0f9ff 100%);
        background-attachment: fixed;
        min-height: 100vh;
        color: var(--dark);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        opacity: 0;
        animation: fadeIn 0.8s ease-out forwards;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    body.animate::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 30%),
            radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 30%),
            radial-gradient(circle at 30% 50%, rgba(245, 158, 11, 0.15) 0%, transparent 45%);
        pointer-events: none;
        z-index: -2;
        animation: gradientShift 25s ease infinite alternate;
        filter: blur(40px);
        opacity: 0;
        transition: opacity 1s ease;
}

body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        linear-gradient(135deg, rgba(240, 244, 255, 0.9) 0%, rgba(240, 249, 255, 0.9) 100%),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%236366f1' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    z-index: -1;
    pointer-events: none;
}

@keyframes gradientShift {
    0% { 
        transform: scale(1) rotate(0deg) translate(0, 0);
    }
    33% {
        transform: scale(1.05) rotate(1deg) translate(10px, 5px);
    }
    66% {
        transform: scale(1.1) rotate(-1deg) translate(-5px, 10px);
    }
    100% { 
        transform: scale(1.05) rotate(0.5deg) translate(5px, -5px);
    }
}

/* Floating elements */
.floating {
    position: fixed;
    border-radius: 50%;
    pointer-events: none;
    z-index: -1;
    filter: blur(60px);
    opacity: 0.7;
    animation: float 20s ease-in-out infinite;
    will-change: transform, opacity;
}

.floating.one {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.5) 0%, transparent 70%);
    top: 20%;
    left: 10%;
    animation-delay: 0s;
    animation-duration: 25s;
}

.floating.two {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.4) 0%, transparent 70%);
    bottom: 10%;
    right: 10%;
    animation-delay: 2s;
    animation-duration: 30s;
}

.floating.three {
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(16, 185, 129, 0.3) 0%, transparent 70%);
    top: 60%;
    left: 20%;
    animation-delay: 4s;
    animation-duration: 35s;
}

@keyframes float {
    0% { 
        transform: translateY(0) rotate(0deg) scale(1);
        opacity: 0.7;
    }
    25% {
        transform: translateY(-50px) rotate(5deg) scale(1.05);
        opacity: 0.8;
    }
    50% {
        transform: translateY(20px) rotate(-5deg) scale(0.95);
        opacity: 0.6;
    }
    75% {
        transform: translateY(-30px) rotate(3deg) scale(1.03);
        opacity: 0.7;
    }
    100% { 
        transform: translateY(0) rotate(0deg) scale(1);
        opacity: 0.7;
    }
}

/* Glow effect */
.glow {
    position: relative;
    z-index: 1;
}

.glow::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: inherit;
    background: inherit;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    filter: blur(15px);
}

.glow:hover::after {
    opacity: 0.7;
    transform: scale(1.05);
}

/* ---------- MAIN CONTENT ---------- */
main {
    max-width: calc(100% - 300px); /* Account for side nav width */
    margin: 100px 20px 2rem 320px; /* Top: navbar height + extra padding, Left: sidebar width + padding */
    padding: 2.5rem;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 1.5rem;
    box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.5);
    position: relative;
    overflow: hidden;
    opacity: 0;
    animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: 0.3s;
    min-height: calc(100vh - 120px); /* Fill viewport height minus header and padding */
}

/* ---------- NAVBAR ---------- */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 80px;
    background: #ffffff !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    display: flex;
    align-items: center;
    border-bottom: 2px solid #f0f0f0;
}

/* Ensure main content starts below navbar */
body {
    padding-top: 80px !important;
}

/* Adjust main content positioning */
main {
    position: relative;
    z-index: 1;
    margin-top: 0;
    padding-top: 2rem;
}

.nav-container {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 100%;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
}

.logo i {
    font-size: 1.75rem;
    color: var(--primary);
}

.nav-menu {
    display: flex;
    gap: 2rem;
    align-items: center;
}

.nav-link {
    color: var(--gray-700);
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    position: relative;
}

.nav-link:hover {
    color: var(--primary);
    background: rgba(99, 102, 241, 0.1);
}

.nav-link.active {
    color: var(--primary);
    background: rgba(99, 102, 241, 0.1);
    font-weight: 600;
}

.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--primary);
    padding: 0.5rem;
}

@keyframes slideUp {
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Add decorative elements */
main::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 200%;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
    animation: rotate 30s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

main::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
}

h1 {
    text-align: center;
    margin-bottom: 2.5rem;
    color: var(--dark);
    font-size: 2.25rem;
    font-weight: 700;
    position: relative;
    display: inline-block;
    left: 50%;
    transform: translateX(-50%);
}

h1::after {
    content: '';
    position: absolute;
    bottom: -0.75rem;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent), var(--secondary));
    background-size: 200% auto;
    border-radius: 3px;
    animation: gradient 3s linear infinite;
}

@keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Add subtle animation to headings */
h2 {
    position: relative;
    display: inline-block;
}

h2::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.5s ease;
}

h2:hover::after {
    width: 100%;
}

h2 {
    font-size: 1.5rem;
    margin: 2rem 0 1.5rem;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

h2 i {
    color: var(--primary);
    font-size: 1.25em;
}

p, li {
    color: var(--gray-700);
    line-height: 1.7;
    margin-bottom: 1rem;
}

ul, ol {
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

.section {
    background: rgba(255,255,255,0.95);
    animation-delay: .2s;
}
@keyframes zoomIn { to { opacity:1; transform: scale(1); } }

/* ---------- INPUT + BUTTON ---------- */
input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    font-size: 15px;
}

button {
    background: linear-gradient(45deg,#ff9a56,#fb2d62);
    color: white;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: .3s;
}
button:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 8px 25px rgba(255,90,120,0.5);
}

/* ---------- SECTIONS ---------- */
.section {
    margin-top: 25px;
    padding: 20px;
    border-radius: 12px;
    background: #f7f9fc;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

/* ---------- FEATURES GRID ---------- */
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 15px;
}

.feature-card {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: .3s;
}
.feature-card:hover {
    transform: translateY(-5px);
}

/* ---------- LOADING ---------- */
.loading {
    text-align: center;
    font-weight: bold;
    color: #fb2d62;
    animation: pulse 1s infinite;
}
@keyframes pulse {
    0%,100% { opacity:1; }
    50% { opacity:.4; }
}

.error { color: red; }

/* ---------- BUTTON STYLES ---------- */
button {
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: var(--transition);
    border: none;
    border-radius: 0.75rem;
    padding: 0.875rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    transform: translateY(0);
}

button:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    color: white;
}

button:active {
    transform: translateY(1px);
    box-shadow: 0 2px 10px rgba(99, 102, 241, 0.4);
}

button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-dark), var(--accent));
    opacity: 0;
    transition: var(--transition);
    z-index: -1;
}

button:hover::before {
    opacity: 1;
}

/* Ripple effect */
button::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
    background-repeat: no-repeat;
    background-position: 50%;
    transform: scale(10, 10);
    opacity: 0;
    transition: transform 0.5s, opacity 1s;
}

button:active::after {
    transform: scale(0, 0);
    opacity: 0.3;
    transition: 0s;
}

/* Card hover effect */
.section {
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), transparent);
    opacity: 0;
    transition: var(--transition);
    z-index: -1;
}

.section:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.section:hover::before {
    opacity: 1;
}

/* Feature cards */
.feature-card {
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.feature-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.5s ease;
}

.feature-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 15px 30px -10px rgba(99, 102, 241, 0.2);
}

.feature-card:hover::after {
    transform: scaleX(1);
}

/* Text-to-Speech Button */
.tts-button {
    background: linear-gradient(135deg, var(--secondary), #0ea5e9);
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    margin-left: 8px;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.tts-button:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.tts-button:active {
    transform: scale(0.95);
}

.tts-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0ea5e9, var(--accent));
    opacity: 0;
    transition: var(--transition);
    z-index: -1;
}

.tts-button:hover::before {
    opacity: 1;
}

.tts-button.speaking {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 1; }
}

/* Responsive Design */
@media (max-width: 1024px) and (min-width: 769px) {
    .sidebar-toggle {
        display: block;
    }
    
    .side-nav {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .side-nav.open {
        transform: translateX(0);
    }
    
    main {
        margin-left: 0;
        margin-right: 0;
        max-width: 100%;
        margin-top: 90px;
        padding: 2rem;
    }
}

@media (max-width: 768px) {
    .navbar {
        height: 70px;
    }
    
    .nav-container {
        padding: 0 1rem;
        height: 70px;
    }
    
    .logo {
        font-size: 1.4rem;
    }
    
    /* Mobile menu - using the toggle button we added */
    #mainNav {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: white;
        flex-direction: column;
        padding: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transform: translateY(-100%);
        opacity: 0;
        pointer-events: none;
        transition: all 0.3s ease;
        z-index: 999;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    #mainNav.active {
        transform: translateY(0);
        opacity: 1;
        pointer-events: all;
    }
    
    #mainNav .nav-item {
        width: 100%;
        text-align: center;
        padding: 0.75rem;
        margin: 0.25rem 0;
        border-radius: 0.5rem;
        border: none;
        background: none;
    }
    
    #mainNav .nav-item:hover {
        background: rgba(99, 102, 241, 0.1);
    }
    
    .mobile-menu-toggle {
        display: block !important;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--primary);
        padding: 0.5rem;
        margin-left: auto;
    }
    
    main {
        margin: 80px 1rem 2rem 1rem;
        padding: 1.5rem;
        max-width: none;
        min-height: calc(100vh - 90px);
    }
    
    h1 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    
    h2 {
        font-size: 1.3rem;
    }
    
    .section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .nlp-horizontal {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .nlp-horizontal span {
        margin-bottom: 0.5rem;
    }
    
    /* Agent action cards responsive */
    .agent-actions-grid {
        grid-template-columns: 1fr !important;
    }
    
    .agent-action-card {
        max-width: 100% !important;
    }
}

/* Add floating elements to the background */
body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: -1;
    background: 
        radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.1) 0%, transparent 30%),
        radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 30%),
        radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.1) 0%, transparent 40%);
    animation: pulse 15s ease infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Responsive Design */
@media (max-width: 1024px) and (min-width: 769px) {
    .sidebar-toggle {
        display: block;
    }
    
    .side-nav {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .side-nav.open {
        transform: translateX(0);
    }
    
    main {
        margin-left: 0;
        margin-right: 0;
        max-width: 100%;
        margin-top: 90px;
        padding: 2rem;
    }
}

@media (max-width: 768px) {
    .navbar {
        height: 70px;
    }
    
    .nav-container {
        padding: 0 1rem;
        height: 70px;
    }
    
    .logo {
        font-size: 1.4rem;
    }
    
    /* Mobile menu - using the toggle button we added */
    #mainNav {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: white;
        flex-direction: column;
        padding: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transform: translateY(-100%);
        opacity: 0;
        pointer-events: none;
        transition: all 0.3s ease;
        z-index: 999;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    #mainNav.active {
        transform: translateY(0);
        opacity: 1;
        pointer-events: all;
    }
    
    #mainNav .nav-item {
        width: 100%;
        text-align: center;
        padding: 0.75rem;
        margin: 0.25rem 0;
        border-radius: 0.5rem;
        border: none;
        background: none;
    }
    
    #mainNav .nav-item:hover {
        background: rgba(99, 102, 241, 0.1);
    }
    
    .mobile-menu-toggle {
        display: block !important;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--primary);
        padding: 0.5rem;
        margin-left: auto;
    }
    
    main {
        margin: 80px 1rem 2rem 1rem;
        padding: 1.5rem;
        max-width: none;
        min-height: calc(100vh - 90px);
    }
    
    h1 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    
    h2 {
        font-size: 1.3rem;
    }
    
    .section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .nlp-horizontal {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .nlp-horizontal span {
        margin-bottom: 0.5rem;
    }
    
    /* Agent action cards responsive */
    .agent-actions-grid {
        grid-template-columns: 1fr !important;
    }
    
    .agent-action-card {
        max-width: 100% !important;
    }
}

/* ---------- FOOTER ---------- */
footer {
    text-align: center;
    padding: 20px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    color: #666;
    font-size: 14px;
    margin-top: 40px;
}

/* ---------- SIDE NAVIGATION ---------- */
.side-nav {
    position: fixed;
    left: 0;
    top: 80px;
    height: calc(100vh - 80px);
    width: 280px;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-right: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
    z-index: 1000;
    transform: translateX(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 1rem 0;
}

/* Sidebar Toggle Button */
.sidebar-toggle {
    position: fixed;
    left: 20px;
    top: 100px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1001;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
}

/* Adjust toggle button position when sidebar is collapsed */
body.sidebar-collapsed .sidebar-toggle {
    left: 10px;
}

.sidebar-toggle:hover {
    background: var(--primary-dark);
    transform: scale(1.1);
}

/* Body class when sidebar is collapsed */
body.sidebar-collapsed .side-nav {
    transform: translateX(-100%);
}

body.sidebar-collapsed main {
    margin-left: 30px;
    transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Main Content Styles */
main {
    margin: 100px auto 3rem;
    max-width: 1200px;
    padding: 2rem 3rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.98);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
}

/* When sidebar is expanded */
body:not(.sidebar-collapsed) main {
    margin: 100px 2rem 3rem 340px;
    max-width: calc(100% - 360px);
    padding: 2.5rem 3rem;
}

/* When sidebar is collapsed */
body.sidebar-collapsed main {
    margin: 100px auto 3rem;
    max-width: 1200px;
    padding: 2.5rem 3.5rem;
}

/* Content sections spacing */
main section {
    margin-bottom: 3rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

main section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    main {
        max-width: 100%;
        padding: 2rem 2.5rem;
    }
    
    body:not(.sidebar-collapsed) main {
        margin: 90px 1.5rem 2.5rem 320px;
        max-width: calc(100% - 340px);
        padding: 2rem 2.5rem;
    }
}

@media (max-width: 992px) {
    body:not(.sidebar-collapsed) main {
        margin-left: 300px;
        max-width: calc(100% - 320px);
    }
}

@media (max-width: 768px) {
    main {
        margin: 80px 1rem 2rem !important;
        padding: 1.5rem 1.25rem !important;
        max-width: 100% !important;
        border-radius: 8px;
    }
    
    body:not(.sidebar-collapsed) main {
        margin: 80px 1rem 2rem !important;
        max-width: 100% !important;
        padding: 1.5rem 1.25rem !important;
    }
    
    main section {
        padding: 1.25rem 0;
        margin-bottom: 2rem;
    }
}

/* Improve typography spacing */
main h1 {
    margin-bottom: 1.75rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(0, 0, 0, 0.05);
}

main h2 {
    margin: 2.25rem 0 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

main p {
    margin-bottom: 1.25rem;
    line-height: 1.7;
}

/* Form elements */
main input,
main button,
main select,
main textarea {
    margin: 0.75rem 0;
}

main button {
    padding: 0.75rem 1.5rem;
    margin: 1rem 0;
}

.side-nav.open {
    transform: translateX(0);
}

.nav-header {
    padding: 1.5rem 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
}

.nav-header h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.nav-header i {
    opacity: 0.8;
}

.voice-toggle-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.voice-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.voice-toggle-btn.active {
    background: linear-gradient(135deg, #10b981, #059669);
    animation: pulse 2s ease-in-out infinite;
}

.nav-content {
    flex: 1;
    padding: 1rem 0;
    overflow-y: auto;
}

.nav-links {
    display: flex;
    flex-direction: column;
    padding: 0 1rem;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: var(--gray-700);
    font-weight: 500;
    border-radius: 0.75rem;
    margin-bottom: 0.25rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.nav-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    transform: scaleY(0);
    transition: transform 0.3s ease;
    border-radius: 0 2px 2px 0;
}

.nav-link:hover {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
    transform: translateX(8px);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.1);
}

.nav-link.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
    color: var(--primary);
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.15);
}

.nav-link.active::before {
    transform: scaleY(1);
}

.nav-link i {
    width: 20px;
    text-align: center;
    font-size: 1rem;
    opacity: 0.8;
}

.nav-footer {
    padding: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    background: rgba(248, 250, 252, 0.8);
}

.voice-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--gray-600);
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ef4444;
    transition: all 0.3s ease;
}

.voice-status.listening .status-indicator {
    background: #10b981;
    animation: pulse 1s ease-in-out infinite;
}

.voice-status.processing .status-indicator {
    background: #f59e0b;
    animation: pulse 0.5s ease-in-out infinite;
}

/* ---------- CHARTS SIDEBAR - BASIC POSITIONING ---------- */
.charts-sidebar {
    position: fixed;
    right: 0;
    top: 80px;
    width: 300px;
    height: calc(100vh - 80px);
    background: rgba(255, 255, 255, 0.98);
    border-left: 1px solid rgba(0, 0, 0, 0.05);
    z-index: 1000;
}

.charts-toggle {
    position: fixed;
    right: 20px;
    top: 100px;
    background: var(--secondary);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1001;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.charts-content {
    padding: 0.5rem;
    height: 100%;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) rgba(0, 0, 0, 0.1);
}

.chart-placeholder {
    text-align: center;
    padding: 2rem;
    color: var(--gray-600);
}

.chart-placeholder h4 {
    color: var(--primary);
    margin-bottom: 1rem;
}

.chart-section {
    margin-bottom: 1.5rem;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: var(--transition);
}

.chart-section:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.chart-section h4 {
    margin: 0 0 0.75rem 0;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    line-height: 1.2;
}

.chart-section h4 i {
    color: var(--primary);
    font-size: 0.9rem;
}

.chart-section canvas {
    width: 100% !important;
    max-width: 240px !important; /* Account for padding */
    height: 160px !important; /* Slightly smaller for better fit */
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

/* Custom scrollbar for charts sidebar */
.charts-content::-webkit-scrollbar {
    width: 4px;
}

.charts-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 2px;
}

.charts-content::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 2px;
}

.charts-content::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* Responsive behavior for charts sidebar */
@media (max-width: 1200px) {
    .charts-sidebar {
        width: 280px;
    }
    
    .charts-toggle {
        right: 15px;
    }
}

@media (max-width: 992px) {
    /* Charts sidebar hidden on tablets by default */
    .charts-sidebar {
        display: none !important; /* Override show state on small screens */
    }
    
    .charts-toggle {
        right: 10px;
    }
}

@media (max-width: 768px) {
    /* Charts sidebar hidden on mobile */
    .charts-sidebar {
        display: none !important;
    }
    
    .charts-toggle {
        display: none; /* Hide toggle button on mobile */
    }
}

/* ---------- NLP HORIZONTAL ---------- */
.nlp-horizontal {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
.nlp-horizontal span {
    font-size: 14px;
}

/* ---------- ANIMATION FOR SECTIONS ---------- */
.section {
    opacity: 0;
    transform: scale(0.9);
    animation: zoomIn 0.5s ease-in-out forwards;
}
</style>
</head>

<body>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" id="sidebarToggle">
    <i class="fas fa-chevron-left"></i>
</button>

<!-- Side Navigation Bar -->
<div id="side-nav" class="side-nav">
    <div class="nav-header">
        <h3><i class="fas fa-navicon"></i> Navigation</h3>
        <button id="voice-toggle" class="voice-toggle-btn" title="Voice Navigation">
            <i class="fas fa-microphone"></i>
        </button>
    </div>
    <div class="nav-content">
        <nav class="nav-links">
            <a href="#overview" class="nav-link active" data-section="overview">
                <i class="fas fa-info-circle"></i> Overview
            </a>
            <a href="#nlp" class="nav-link" data-section="nlp">
                <i class="fas fa-file-alt"></i> NLP Extraction
            </a>
            <a href="#anomaly" class="nav-link" data-section="anomaly">
                <i class="fas fa-chart-line"></i> Anomaly Detection
            </a>
            <a href="#duplicate" class="nav-link" data-section="duplicate">
                <i class="fas fa-copy"></i> Duplicate Detection
            </a>
            <a href="#fraud" class="nav-link" data-section="fraud">
                <i class="fas fa-network-wired"></i> Fraud Analysis
            </a>
            <a href="#integrated" class="nav-link" data-section="integrated">
                <i class="fas fa-chart-bar"></i> Integrated Analysis
            </a>
            <a href="#agentic" class="nav-link" data-section="agentic">
                <i class="fas fa-brain"></i> Agentic Reasoning
            </a>
        </nav>
    </div>
    <div class="nav-footer">
        <div id="voice-status" class="voice-status">
            <span class="status-indicator"></span>
            <span class="status-text">Voice Off</span>
        </div>
    </div>
</div>

<!-- Navigation Bar -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">
            <i class="fas fa-shield-alt"></i>
            <span>Prayatna</span>
        </div>
        <div class="nav-menu">
            <a href="/" class="nav-link">Home</a>
            <a href="/dashboard" class="nav-link">Dashboard</a>
            <a href="/pipeline-page" class="nav-link active">Pipeline</a>
            <a href="/agentic" class="nav-link">Agentic AI</a>
        </div>
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</nav>

<main>

<h1>Fraud Detection Pipeline</h1>

<section class="intro" id="overview">
    <h2>Overview</h2>
    <p>The Fraud Detection Pipeline is a comprehensive analytical tool designed to perform end-to-end fraud assessment on beneficiary data extracted from PDF documents. By integrating multiple AI-powered modules, it provides a holistic evaluation of potential fraudulent activities in welfare distribution systems.</p>

    <h2>Process Flow</h2>
    <ol>
        <li><i class="fas fa-file-upload"></i> <strong>Document Upload:</strong> Upload a PDF containing beneficiary information for analysis.</li>
        <li><i class="fas fa-brain"></i> <strong>Natural Language Processing (NLP):</strong> Extract and process key features from unstructured text data.</li>
        <li><i class="fas fa-chart-line"></i> <strong>Anomaly Detection:</strong> Identify statistical outliers and irregular patterns in transaction data.</li>
        <li><i class="fas fa-copy"></i> <strong>Duplicate Detection:</strong> Scan for identical or highly similar beneficiary records.</li>
        <li><i class="fas fa-network-wired"></i> <strong>Fraud Network Analysis:</strong> Examine relational networks to uncover organized fraud schemes and influential entities.</li>
    </ol>

    <h2>Requirements & Tips</h2>
    <ul>
        <li><strong>Document Format:</strong> Ensure the PDF includes structured beneficiary data such as names, addresses, and transaction amounts for optimal analysis.</li>
        <li><strong>Processing Time:</strong> Analysis duration varies based on document complexity and size; typically completes within seconds.</li>
        <li><strong>Output:</strong> Results are presented in categorized sections with detailed feature extractions for transparent review.</li>
    </ul>
</section>

<label for="pdfFile">Select PDF Document</label>
<input type="file" id="pdfFile" accept=".pdf">
<button onclick="runBasicPipeline()"><i class="fas fa-play"></i> Run Basic Pipeline</button>

<div id="result"></div>

</main>

<footer>
    2026 Prayatna Fraud Detection System
</footer>

<script>
// Mobile menu toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const navMenu = document.querySelector('.nav-menu');
    
    if (mobileMenuToggle && navMenu) {
        mobileMenuToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            navMenu.classList.toggle('active');
            
            // Update toggle icon
            const icon = this.querySelector('i');
            if (icon) {
                if (navMenu.classList.contains('active')) {
                    icon.className = 'fas fa-times';
                } else {
                    icon.className = 'fas fa-bars';
                }
            }
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!navMenu.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                navMenu.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (icon) {
                    icon.className = 'fas fa-bars';
                }
            }
        });
        
        // Close menu when clicking on a nav item
        navMenu.addEventListener('click', function(event) {
            if (event.target.classList.contains('nav-link')) {
                navMenu.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (icon) {
                    icon.className = 'fas fa-bars';
                }
            }
        });
    }
    
    // Sidebar toggle functionality for tablets (keeping existing functionality)
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sideNav = document.getElementById('side-nav');
    
    if (sidebarToggle && sideNav) {
        sidebarToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            sideNav.classList.toggle('open');
            
            // Update toggle icon
            const icon = this.querySelector('i');
            if (icon) {
                if (sideNav.classList.contains('open')) {
                    icon.className = 'fas fa-times';
                } else {
                    icon.className = 'fas fa-bars';
                }
            }
        });
    }
});

function formatValue(v){
 if(v==null) return "‚Äî";
 if(typeof v==="object") return JSON.stringify(v,null,1);
 return v;
}

function renderFeatures(features){
 if(!features) return "<p>No data</p>";

 let html=`<div class="features-grid">`;
 for(const [k,v] of Object.entries(features)){
  html+=`<div class="feature-card">
           <h4>${k.replace(/_/g," ")}</h4>
           <p>${formatValue(v)}</p>
         </div>`;
 }
 html+="</div>";
 return html;
}

function renderSection(title,data){
 if(title === "ü§ñ Agentic Reasoning" && data && typeof data === 'object'){
  let html=`<div class="section" id="agentic">
          <h2><i class="fas fa-brain"></i> ${title}
            <button onclick="speakSection(this.parentElement.parentElement)" class="tts-button" title="Listen to this section">
              <i class="fas fa-volume-up"></i>
            </button>
          </h2>`;

  if(data.explanation){
   html += '<h3>AI Explanation</h3>';
   if(typeof data.explanation === 'object'){
    html += '<p><strong>Summary:</strong> ' + String(data.explanation.summary || '') + '</p>';
    if(data.explanation.key_points && data.explanation.key_points.length > 0){
     html += '<ul>';
     data.explanation.key_points.forEach(point => {
      html += '<li>' + String(point) + '</li>';
     });
     html += '</ul>';
    }
   } else {
    html += '<p>' + String(data.explanation) + '</p>';
   }
  }

  if(data.audit_summary){
   html += '<h3>Audit Summary</h3>';
   if(typeof data.audit_summary === 'object'){
    if(data.audit_summary.case_overview){
     html += '<p><strong>Case Overview:</strong> ' + String(data.audit_summary.case_overview) + '</p>';
    }
    if(data.audit_summary.key_fraud_indicators && data.audit_summary.key_fraud_indicators.length > 0){
     html += '<p><strong>Key Fraud Indicators:</strong></p><ul>';
     data.audit_summary.key_fraud_indicators.forEach(indicator => {
      html += '<li>' + String(indicator) + '</li>';
     });
     html += '</ul>';
    }
    if(data.audit_summary.evidence_summary){
     html += '<p><strong>Evidence Summary:</strong> ' + String(data.audit_summary.evidence_summary) + '</p>';
    }
    if(data.audit_summary.recommended_action){
     html += '<p><strong>Recommended Action:</strong> ' + String(data.audit_summary.recommended_action) + '</p>';
    }
   } else {
    html += '<p>' + String(data.audit_summary) + '</p>';
   }
  }

  // Admin Agent Calling Section - Added after AI reasoning
  html += '<div class="admin-agent-section" style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.1)); border: 2px solid #8b5cf6; border-radius: 1rem;">';
  html += '<h3 style="color: #7c3aed; margin-bottom: 1rem;"><i class="fas fa-robot"></i> Admin Agent Actions</h3>';
  html += '<p style="margin-bottom: 1rem; color: #4c1d95;">Based on the AI analysis above, the admin agent can take the following actions:</p>';

  html += '<div class="agent-actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">';

  // Action 1: Initiate Investigation
  html += '<div class="agent-action-card" style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; border-radius: 0.75rem; padding: 1rem; text-align: center;">';
  html += '<i class="fas fa-search" style="font-size: 2rem; color: #d97706; margin-bottom: 0.5rem;"></i>';
  html += '<h4 style="color: #92400e; margin-bottom: 0.5rem;">Initiate Investigation</h4>';
  html += '<p style="color: #78350f; font-size: 0.9rem; margin-bottom: 1rem;">Start a formal investigation process</p>';
  html += '<button onclick="callAdminAgent(\'initiate_investigation\', ' + JSON.stringify(data).replace(/'/g, "\\'") + ')" class="agent-btn" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">Execute</button>';
  html += '</div>';

  // Action 2: Freeze Payments
  html += '<div class="agent-action-card" style="background: linear-gradient(135deg, #fee2e2, #fecaca); border: 2px solid #ef4444; border-radius: 0.75rem; padding: 1rem; text-align: center;">';
  html += '<i class="fas fa-ban" style="font-size: 2rem; color: #dc2626; margin-bottom: 0.5rem;"></i>';
  html += '<h4 style="color: #991b1b; margin-bottom: 0.5rem;">Freeze Payments</h4>';
  html += '<p style="color: #7f1d1d; font-size: 0.9rem; margin-bottom: 1rem;">Temporarily halt beneficiary payments</p>';
  html += '<button onclick="callAdminAgent(\'freeze_payments\', ' + JSON.stringify(data).replace(/'/g, "\\'") + ')" class="agent-btn" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">Execute</button>';
  html += '</div>';

  // Action 3: Schedule Interview
  html += '<div class="agent-action-card" style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 2px solid #3b82f6; border-radius: 0.75rem; padding: 1rem; text-align: center;">';
  html += '<i class="fas fa-calendar-check" style="font-size: 2rem; color: #2563eb; margin-bottom: 0.5rem;"></i>';
  html += '<h4 style="color: #1e40af; margin-bottom: 0.5rem;">Schedule Interview</h4>';
  html += '<p style="color: #1d4ed8; font-size: 0.9rem; margin-bottom: 1rem;">Arrange beneficiary interview</p>';
  html += '<button onclick="callAdminAgent(\'schedule_interview\', ' + JSON.stringify(data).replace(/'/g, "\\'") + ')" class="agent-btn" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">Execute</button>';
  html += '</div>';

  // Action 4: Generate Report
  html += '<div class="agent-action-card" style="background: linear-gradient(135deg, #d1fae5, #a7f3d0); border: 2px solid #10b981; border-radius: 0.75rem; padding: 1rem; text-align: center;">';
  html += '<i class="fas fa-file-pdf" style="font-size: 2rem; color: #059669; margin-bottom: 0.5rem;"></i>';
  html += '<h4 style="color: #047857; margin-bottom: 0.5rem;">Generate Report</h4>';
  html += '<p style="color: #065f46; font-size: 0.9rem; margin-bottom: 1rem;">Create comprehensive fraud report</p>';
  html += '<button onclick="callAdminAgent(\'generate_report\', ' + JSON.stringify(data).replace(/'/g, "\\'") + ')" class="agent-btn" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">Execute</button>';
  html += '</div>';

  html += '</div></div>';

  html += '</div>';
  return html;
 } else if(title.includes('NLP')) {
  return `<div class="section" id="nlp">
          <h2><i class="fas fa-file-alt"></i> ${title}
            <button onclick="speakSection(this.parentElement.parentElement)" class="tts-button" title="Listen to this section">
              <i class="fas fa-volume-up"></i>
            </button>
          </h2>
          <div class="nlp-horizontal">
            ${Object.entries(data).map(([k,v]) => `<span><strong>${k.replace(/_/g," ")}:</strong> ${formatValue(v)}</span>`).join(' | ')}
          </div>
        </div>`;
 } else {
  let icon = 'file-alt';
  let sectionId = '';
  if(title.includes('Anomaly')) {
    icon = 'chart-line';
    sectionId = 'anomaly';
  }
  else if(title.includes('Duplicate')) {
    icon = 'copy';
    sectionId = 'duplicate';
  }
  else if(title.includes('Fraud')) {
    icon = 'network-wired';
    sectionId = 'fraud';
  }
  else if(title.includes('Integrated')) {
    icon = 'chart-bar';
    sectionId = 'integrated';
  }
  return `<div class="section" id="${sectionId}">
          <h2><i class="fas fa-${icon}"></i> ${title}
            <button onclick="speakSection(this.parentElement.parentElement)" class="tts-button" title="Listen to this section">
              <i class="fas fa-volume-up"></i>
            </button>
          </h2>
          ${renderFeatures(data)}
        </div>`;
 }
}

async function runBasicPipeline(){
 const file=document.getElementById("pdfFile").files[0];
 const resultDiv=document.getElementById("result");

 if(!file){ alert("Select a PDF"); return; }

 const fd=new FormData();
 fd.append("file",file);

  resultDiv.innerHTML=`<div class="loading"><div class="spinner"></div> Running basic fraud detection pipeline...</div>`;

 try{
  const res=await fetch("/pipeline-basic",{method:"POST",body:fd});
  const data=await res.json();

  let html="";
  html+=renderSection("üìÑ NLP Extraction",data.nlp_extraction);
  html+=renderSection("üìä Anomaly Detection",data.anomaly_detection);
  html+=renderSection("üîÅ Duplicate Detection",data.duplicate_detection);
  html+=renderSection("üï∏ Fraud Network Analysis",data.fraud_network_analysis);
  html+=`<button onclick='runAgentic(${JSON.stringify(data).replace(/'/g, "\'")})'><i class="fas fa-brain"></i> Run Agentic Reasoning</button>`;

  resultDiv.innerHTML=html;

  // Update charts with real pipeline data after completion
  setTimeout(() => {
      const pipelineData = extractPipelineData();
      if (pipelineData) {
          updateChartsWithData(pipelineData);
      }
  }, 500); // Wait for DOM to update

 }catch(err){
  resultDiv.innerHTML=`<p class="error">${err.message}</p>`;
 }
}

async function runAgentic(basicData){
 const resultDiv=document.getElementById("result");

 // Add debugging
 console.log('runAgentic called with data:', basicData);

 // Append loading for agentic
 resultDiv.innerHTML += `<div class="loading"><div class="spinner"></div> Running agentic reasoning...</div>`;

 try{
  console.log('Making fetch request to /admin-decision/agentic-reasoning/analyze');
  const res=await fetch("/admin-decision/agentic-reasoning/analyze",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify(basicData)
  });

  console.log('Fetch response status:', res.status);
  console.log('Fetch response ok:', res.ok);

  const data=await res.json();
  console.log('Response data:', data);

  // Check if the response contains an error
  if (data.error) {
    console.error('Backend returned error:', data.error);
    resultDiv.innerHTML = resultDiv.innerHTML.replace(/<div class="loading">Running agentic reasoning\.\.\.<\/div>$/, '');

    // Create a user-friendly error display
    const errorHtml = `
      <div class="section error-section" id="agentic" style="border: 2px solid #ef4444; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));">
        <h2><i class="fas fa-exclamation-triangle"></i> AI Reasoning Error</h2>
        <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 0.5rem; margin: 1rem 0;">
          <p style="color: #dc2626; margin-bottom: 1rem;"><strong>AI Service Issue:</strong> ${data.error}</p>
          ${data.error.includes('rate limit') ? `
            <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
              <h4 style="color: #d97706; margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> Solutions:</h4>
              <ul style="color: #92400e; margin: 0; padding-left: 1.5rem;">
                <li>Add credits to your OpenRouter account (recommended)</li>
                <li>Wait for the daily limit to reset</li>
                <li>Switch to a different AI provider</li>
              </ul>
            </div>
          ` : ''}
        </div>
        <p style="color: #6b7280; font-size: 0.9rem;">You can still use the basic fraud detection features without AI reasoning.</p>
      </div>
    `;

    resultDiv.innerHTML += errorHtml;
    return;
  }

  // Remove loading and add agentic section
  resultDiv.innerHTML = resultDiv.innerHTML.replace(/<div class="loading">Running agentic reasoning\.\.\.<\/div>$/, '');
  resultDiv.innerHTML += renderSection("ü§ñ Agentic Reasoning",data);

  // Update charts with complete pipeline data including agentic results
  setTimeout(() => {
      const pipelineData = extractPipelineData();
      if (pipelineData) {
          updateChartsWithData(pipelineData);
      }
  }, 500); // Wait for DOM to update

 }catch(err){
  console.error('Error in runAgentic:', err);
  resultDiv.innerHTML += `<p class="error">${err.message}</p>`;
 }
}

// Text-to-Speech functionality
let currentSpeech = null;

function speakSection(sectionElement) {
    const button = sectionElement.querySelector('.tts-button');
    const text = extractTextFromSection(sectionElement);
    
    if (currentSpeech && !currentSpeech.paused) {
        // Stop current speech
        currentSpeech.stop();
        button.classList.remove('speaking');
        button.innerHTML = '<i class="fas fa-volume-up"></i>';
        return;
    }
    
    if (currentSpeech) {
        currentSpeech.stop();
    }
    
    // Start new speech
    currentSpeech = new SpeechSynthesisUtterance(text);
    
    // Configure speech settings
    currentSpeech.rate = 0.9; // Slightly slower than default
    currentSpeech.pitch = 1; // Normal pitch
    currentSpeech.volume = 0.8; // Slightly quieter
    
    // Update button state
    button.classList.add('speaking');
    button.innerHTML = '<i class="fas fa-stop"></i>';
    
    // Handle speech end
    currentSpeech.onend = function() {
        button.classList.remove('speaking');
        button.innerHTML = '<i class="fas fa-volume-up"></i>';
        currentSpeech = null;
    };
    
    // Handle speech error
    currentSpeech.onerror = function() {
        button.classList.remove('speaking');
        button.innerHTML = '<i class="fas fa-volume-up"></i>';
        currentSpeech = null;
        console.error('Speech synthesis error');
    };
    
    // Start speaking
    window.speechSynthesis.speak(currentSpeech);
}

function extractTextFromSection(sectionElement) {
    // Extract clean text from the section for speech synthesis
    const clone = sectionElement.cloneNode(true);
    
    // Remove the TTS button from the text
    const ttsButtons = clone.querySelectorAll('.tts-button');
    ttsButtons.forEach(btn => btn.remove());
    
    // Get all text content
    let text = clone.textContent || clone.innerText;
    
    // Clean up the text
    text = text.replace(/\s+/g, ' ').trim();
    
    // Remove extra whitespace and normalize
    text = text.replace(/(\s*\n\s*)+/g, '. ');
    text = text.replace(/\s*\.\s*\./g, '.');
    text = text.replace(/\s*,\s*,/g, ',');
    
    // Remove special characters and icons
    text = text.replace(/[ü§ñüìÑüìäüîÅüï∏]/g, '');
    
    return text;
}

// Stop all speech when page unloads
window.addEventListener('beforeunload', function() {
    if (currentSpeech) {
        currentSpeech.stop();
    }
});

// Admin Agent Tool Calling Functions
async function callAdminAgent(action, agenticData) {
    try {
        // Show loading state on the button
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Executing...';
        button.disabled = true;
        button.style.opacity = '0.7';

        let endpoint = '';
        let payload = {};

        switch(action) {
            case 'initiate_investigation':
                endpoint = '/admin-decision/init-cases';
                payload = {
                    beneficiary_id: 'AI_AGENT_' + Date.now(),
                    priority: 'critical',
                    ai_analysis: agenticData,
                    action_type: 'investigation_initiated',
                    timestamp: new Date().toISOString()
                };
                break;

            case 'freeze_payments':
                endpoint = '/admin-decision/decide';
                payload = {
                    case_id: `AI_AGENT_FREEZE_${Date.now()}`,
                    decision: 'frozen',
                    notes: `AI Agent: Payment freeze initiated based on agentic analysis. Risk indicators detected.`,
                    ai_analysis: agenticData,
                    automated_action: true
                };
                break;

            case 'schedule_interview':
                endpoint = '/admin-decision/decide';
                payload = {
                    case_id: `AI_AGENT_INTERVIEW_${Date.now()}`,
                    decision: 'interview_scheduled',
                    notes: `AI Agent: Interview scheduled based on agentic reasoning analysis.`,
                    ai_analysis: agenticData,
                    automated_action: true
                };
                break;

            case 'generate_report':
                // Use the existing report generation endpoint
                const response = await fetch('/generate-report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        beneficiary_id: 'AI_AGENT_' + Date.now(),
                        agentic_analysis: agenticData,
                        report_type: 'ai_agent_generated',
                        timestamp: new Date().toISOString(),
                        automated_generation: true
                    })
                });

                if (response.ok) {
                    // Create download link
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ai_agent_fraud_report_${Date.now()}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                    showAgentNotification('Report generated and downloaded successfully!', 'success', 'üìÑ');
                } else {
                    throw new Error('Failed to generate AI agent report');
                }

                // Restore button state
                button.innerHTML = originalText;
                button.disabled = false;
                button.style.opacity = '1';
                return;

            default:
                throw new Error('Unknown agent action: ' + action);
        }

        // Make the API call for other actions
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (response.ok) {
            let icon = 'ü§ñ';
            if (action.includes('investigation')) icon = 'üîç';
            if (action.includes('freeze')) icon = '‚ùÑÔ∏è';
            if (action.includes('interview')) icon = 'üìÖ';

            showAgentNotification(`AI Agent action "${action.replace('_', ' ')}" executed successfully!`, 'success', icon);
        } else {
            throw new Error(result.error || 'Agent action failed');
        }

    } catch (error) {
        console.error('Admin agent error:', error);
        showAgentNotification(`Agent action failed: ${error.message}`, 'error', '‚ùå');
    } finally {
        // Always restore button state
        const button = event.target;
        if (button) {
            button.innerHTML = 'Execute';
            button.disabled = false;
            button.style.opacity = '1';
        }
    }
}

function showAgentNotification(message, type = 'info', icon = 'ü§ñ') {
    // Create notification element with AI agent styling
    const notification = document.createElement('div');
    notification.className = `agent-notification ${type}`;
    notification.innerHTML = `
        <div class="agent-notification-content">
            <span class="agent-icon">${icon}</span>
            <div class="agent-message">
                <strong>AI Agent:</strong> ${message}
            </div>
        </div>
    `;

    // Add to page with special styling for AI agent notifications
    document.body.appendChild(notification);

    // Style the notification with AI agent theme
    Object.assign(notification.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        background: type === 'success' ?
                   'linear-gradient(135deg, #10b981, #059669)' :
                   type === 'error' ?
                   'linear-gradient(135deg, #ef4444, #dc2626)' :
                   'linear-gradient(135deg, #6366f1, #4f46e5)',
        color: 'white',
        padding: '1.2rem 1.5rem',
        borderRadius: '1rem',
        boxShadow: '0 15px 35px rgba(0, 0, 0, 0.2)',
        zIndex: '10000',
        border: '2px solid rgba(255, 255, 255, 0.2)',
        backdropFilter: 'blur(10px)',
        transform: 'translateX(100%)',
        transition: 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',
        maxWidth: '400px'
    });

    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);

    // Auto remove after 6 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 400);
    }, 6000);

    // Add some extra styling for the content
    const content = notification.querySelector('.agent-notification-content');
    Object.assign(content.style, {
        display: 'flex',
        alignItems: 'center',
        gap: '0.75rem'
    });

    const agentIcon = notification.querySelector('.agent-icon');
    Object.assign(agentIcon.style, {
        fontSize: '1.5rem',
        animation: 'pulse 2s ease-in-out infinite'
    });

    const agentMessage = notification.querySelector('.agent-message');
    Object.assign(agentMessage.style, {
        fontSize: '0.95rem',
        lineHeight: '1.4'
    });
}

// ========== SIDE NAVIGATION FUNCTIONALITY ==========
let voiceRecognition = null;
let isVoiceActive = false;

// Initialize side navigation
function initSideNav() {
    const sideNav = document.getElementById('side-nav');
    const sidebarToggle = document.createElement('button');
    sidebarToggle.className = 'sidebar-toggle';
    sidebarToggle.id = 'sidebarToggle';
    sidebarToggle.innerHTML = '<i class="fas fa-chevron-left"></i>';
    document.body.appendChild(sidebarToggle);
    
    const voiceToggle = document.getElementById('voice-toggle');
    const voiceStatus = document.getElementById('voice-status');

    // Toggle sidebar
    if (sidebarToggle && sideNav) {
        // Toggle sidebar on button click
        sidebarToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            document.body.classList.toggle('sidebar-collapsed');
            
            // Toggle icon
            const icon = this.querySelector('i');
            if (icon) {
                icon.classList.toggle('fa-chevron-left');
                icon.classList.toggle('fa-chevron-right');
            }
            
            // Save state in localStorage
            const isCollapsed = document.body.classList.contains('sidebar-collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        });
        
        // Load saved state
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        if (isCollapsed) {
            document.body.classList.add('sidebar-collapsed');
            const icon = sidebarToggle.querySelector('i');
            if (icon) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            }
        }
    }

    // Voice toggle functionality
    voiceToggle.addEventListener('click', toggleVoiceNavigation);

    // Navigation link clicks (only for side navigation with data-section)
    document.querySelectorAll('.nav-link[data-section]').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const section = link.getAttribute('data-section');
            scrollToSection(section);
            updateActiveNavLink(section);
        });
    });

    // Update active nav link on scroll
    window.addEventListener('scroll', updateActiveNavOnScroll);

    // Initialize voice recognition if supported
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        voiceRecognition = new SpeechRecognition();
        voiceRecognition.continuous = true;
        voiceRecognition.interimResults = false;
        voiceRecognition.lang = 'en-US';

        voiceRecognition.onstart = () => {
            voiceStatus.classList.add('listening');
            voiceStatus.classList.remove('processing');
            voiceStatus.querySelector('.status-text').textContent = 'Listening...';
            voiceToggle.classList.add('active');
        };

        voiceRecognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
            handleVoiceCommand(transcript);
        };

        voiceRecognition.onend = () => {
            if (isVoiceActive) {
                // Restart if still active
                voiceRecognition.start();
            } else {
                voiceStatus.classList.remove('listening', 'processing');
                voiceStatus.querySelector('.status-text').textContent = 'Voice Off';
                voiceToggle.classList.remove('active');
            }
        };

        voiceRecognition.onerror = (event) => {
            console.error('Voice recognition error:', event.error);
            voiceStatus.classList.remove('listening', 'processing');
            voiceStatus.querySelector('.status-text').textContent = 'Error';
            setTimeout(() => {
                voiceStatus.querySelector('.status-text').textContent = 'Voice Off';
            }, 2000);
        };
    } else {
        voiceToggle.style.opacity = '0.5';
        voiceToggle.title = 'Voice recognition not supported in this browser';
        voiceStatus.querySelector('.status-text').textContent = 'Not Supported';
    }
}

// Toggle voice navigation
function toggleVoiceNavigation() {
    const voiceStatus = document.getElementById('voice-status');

    if (!voiceRecognition) {
        showVoiceNotification('Voice recognition not supported in this browser', 'error');
        return;
    }

    if (isVoiceActive) {
        stopVoiceNavigation();
    } else {
        startVoiceNavigation();
    }
}

// Start voice navigation
function startVoiceNavigation() {
    try {
        isVoiceActive = true;
        voiceRecognition.start();
        showVoiceNotification('Voice navigation activated! Say "go to [section]" or "navigate to [section]"', 'success');
    } catch (error) {
        console.error('Error starting voice recognition:', error);
        showVoiceNotification('Failed to start voice recognition', 'error');
        isVoiceActive = false;
    }
}

// Stop voice navigation
function stopVoiceNavigation() {
    isVoiceActive = false;
    if (voiceRecognition) {
        voiceRecognition.stop();
    }
    showVoiceNotification('Voice navigation deactivated', 'info');
}

// Handle voice commands
function handleVoiceCommand(transcript) {
    console.log('Voice command received:', transcript);

    const voiceStatus = document.getElementById('voice-status');
    voiceStatus.classList.add('processing');
    voiceStatus.classList.remove('listening');
    voiceStatus.querySelector('.status-text').textContent = 'Processing...';

    // Special commands that trigger actions
    const specialCommands = {
        'run basic pipeline': 'run-basic',
        'run enhanced reasoning': 'run-enhanced',
        'run agentic reasoning': 'run-enhanced',
        'start listening': 'start-listening',
        'stop listening': 'stop-listening',
        'exit': 'stop-listening',
        'help': 'show-help'
    };

    // Check for special commands first
    for (const [command, action] of Object.entries(specialCommands)) {
        if (transcript.toLowerCase().includes(command)) {
            handleSpecialCommand(action, transcript);
            return;
        }
    }

    // Define section mappings with all possible variations
    const sectionMappings = {
        'overview': {
            id: 'overview',
            aliases: ['overview', 'introduction', 'welcome', 'home', 'main'],
            element: document.querySelector('#overview')
        },
        'nlp': {
            id: 'nlp',
            aliases: ['nlp', 'natural language processing', 'text analysis', 'nlp extraction', 'nlp analysis', 'text extraction'],
            element: document.querySelector('#nlp')
        },
        'anomaly': {
            id: 'anomaly',
            aliases: ['anomaly', 'anomaly detection', 'find anomalies', 'anomaly analysis', 'unusual patterns'],
            element: document.querySelector('#anomaly')
        },
        'duplicate': {
            id: 'duplicate',
            aliases: ['duplicate', 'duplicate detection', 'find duplicates', 'duplicate analysis', 'duplicates'],
            element: document.querySelector('#duplicate')
        },
        'fraud': {
            id: 'fraud',
            aliases: ['fraud', 'fraud detection', 'fraud analysis', 'fraud check', 'fraudulent activity'],
            element: document.querySelector('#fraud')
        },
        'integrated': {
            id: 'integrated',
            aliases: ['integrated', 'integrated analysis', 'combined analysis', 'full analysis', 'results', 'summary'],
            element: document.querySelector('#integrated')
        },
        'agentic': {
            id: 'agentic',
            aliases: ['agentic', 'agentic reasoning', 'agent analysis', 'agent results', 'ai analysis', 'ai reasoning'],
            element: document.querySelector('#agentic')
        }
    };

    // Check for navigation patterns
    const navPatterns = [
        /(?:go to|navigate to|show|scroll to|view|open) (?:the )?(?:section )?(.+)/i,
        /(?:take me to|show me|display|see) (?:the )?(?:section )?(.+)/i,
        /^(?:show |display |view )?(.+?)(?: section| analysis| extraction| view| page)?$/i
    ];

    // Extract the section name from the transcript
    let sectionName = '';
    for (const pattern of navPatterns) {
        const match = transcript.match(pattern);
        if (match && match[1]) {
            sectionName = match[1].toLowerCase().trim();
            break;
        }
    }
    
    // If no pattern matched, use the whole transcript
    if (!sectionName) {
        sectionName = transcript.toLowerCase().trim();
    }

    // Find the best matching section
    let bestMatch = null;
    let bestScore = 0;
    const threshold = 0.4; // Lower threshold for more flexible matching

    for (const [sectionId, section] of Object.entries(sectionMappings)) {
        if (!section.element) continue; // Skip if element doesn't exist
        
        // Check against all aliases
        for (const alias of section.aliases) {
            const score = calculateSimilarity(sectionName, alias);
            if (score > bestScore && score > threshold) {
                bestScore = score;
                bestMatch = section;
            }
        }
    }

    // If we found a match, navigate to it
    if (bestMatch) {
        scrollToSection(bestMatch.id);
        updateActiveNavLink(bestMatch.id);
        showVoiceNotification(`Navigating to ${bestMatch.id}`, 'success');
    } else {
        // If no match found, show help
        const availableSections = Object.values(sectionMappings)
            .filter(s => s.element)
            .map(s => s.aliases[0])
            .join(', ');
            
        showVoiceNotification(
            `I couldn't find a section matching "${transcript}". ` +
            `Available sections: ${availableSections}. ` +
            'Try saying something like "go to overview" or "show me the fraud section".',
            'warning'
        );
    }
    
    resetVoiceStatus();
}

// Helper function to calculate similarity between two strings (0 to 1)
function calculateSimilarity(str1, str2) {
    if (!str1 || !str2) return 0;
    
    // Convert to lowercase and trim
    str1 = str1.toString().toLowerCase().trim();
    str2 = str2.toString().toLowerCase().trim();
    
    // Check for direct match
    if (str1 === str2) return 1;
    
    // Check for partial match
    if (str1.includes(str2) || str2.includes(str1)) {
        return 0.9 * (Math.min(str1.length, str2.length) / Math.max(str1.length, str2.length));
    }
    
    // Calculate Jaccard similarity using character bigrams
    const getBigrams = (str) => {
        const bigrams = new Set();
        for (let i = 0; i < str.length - 1; i++) {
            bigrams.add(str.substr(i, 2));
        }
        return bigrams;
    };
    
    const bigrams1 = getBigrams(str1);
    const bigrams2 = getBigrams(str2);
    
    const intersection = new Set([...bigrams1].filter(x => bigrams2.has(x)));
    const union = new Set([...bigrams1, ...bigrams2]);
    
    return union.size > 0 ? intersection.size / union.size : 0;
}


// Handle special commands like run-basic, run-enhanced, etc.
function handleSpecialCommand(action, transcript) {
    switch(action) {
        case 'run-basic':
            runBasicPipeline();
            showVoiceNotification('Running basic fraud detection pipeline', 'success');
            break;
            
    const resultDiv = document.getElementById('result');
    if (!resultDiv || !resultDiv.innerHTML.trim()) {
        showVoiceNotification('Please run basic pipeline first to get data for agentic reasoning', 'warning');
        return;
    }

    const data = extractDataFromPage();
    if (!data) {
        showVoiceNotification('Unable to extract data from page. Please run basic pipeline first', 'error');
        return;
    }

    runAgentic(data);
    showVoiceNotification('Running enhanced agentic reasoning', 'success');
            
        case 'start-listening':
            startVoiceNavigation();
            break;
            
        case 'stop-listening':
            stopVoiceNavigation();
            break;
            
        case 'show-help':
            const availableSections = Array.from(document.querySelectorAll('section[id]'))
                .map(section => section.id.replace(/-/g, ' '))
                .join(', ');
            showVoiceNotification(`Available sections: ${availableSections}. Try saying 'go to [section name]'`, 'info');
            break;
    }
    
    resetVoiceStatus();
}

// Reset voice status after processing
function resetVoiceStatus() {
    const voiceStatus = document.getElementById('voice-status');
    if (isVoiceActive) {
        setTimeout(() => {
            voiceStatus.classList.remove('processing');
            voiceStatus.classList.add('listening');
            voiceStatus.querySelector('.status-text').textContent = 'Listening...';
        }, 1000);
    }

    // Reset processing state after a delay
    setTimeout(() => {
        if (isVoiceActive) {
            voiceStatus.classList.remove('processing');
            voiceStatus.classList.add('listening');
            voiceStatus.querySelector('.status-text').textContent = 'Listening...';
        }
    }, 1000);
}

// Extract data from page for agentic reasoning
function extractDataFromPage() {
    // This is a simplified extraction - in real implementation you'd parse the actual data
    // For now, return a basic structure that the agentic function expects
    try {
        const sections = document.querySelectorAll('.section');
        const data = {};

        sections.forEach(section => {
            const title = section.querySelector('h2')?.textContent?.trim();
            if (title) {
                if (title.includes('NLP')) {
                    data.nlp_extraction = section.querySelector('pre')?.textContent || section.textContent;
                } else if (title.includes('Anomaly')) {
                    data.anomaly_detection = section.querySelector('pre')?.textContent || section.textContent;
                } else if (title.includes('Duplicate')) {
                    data.duplicate_detection = section.querySelector('pre')?.textContent || section.textContent;
                } else if (title.includes('Fraud')) {
                    data.fraud_network_analysis = section.querySelector('pre')?.textContent || section.textContent;
                }
            }
        });

        return Object.keys(data).length > 0 ? data : null;
    } catch (error) {
        console.error('Error extracting data from page:', error);
        return null;
    }
}

// Extract pipeline data from page sections
function extractPipelineData() {
    try {
        const sections = document.querySelectorAll('.section');
        const data = {
            nlp: {},
            anomaly: {},
            duplicate: {},
            fraud: {},
            agentic: {}
        };

        sections.forEach(section => {
            const title = section.querySelector('h2')?.textContent?.trim();

            if (title) {
                if (title.includes('NLP')) {
                    data.nlp = extractNLPData(section);
                } else if (title.includes('Anomaly')) {
                    data.anomaly = extractAnomalyData(section);
                } else if (title.includes('Duplicate')) {
                    data.duplicate = extractDuplicateData(section);
                } else if (title.includes('Fraud')) {
                    data.fraud = extractFraudData(section);
                } else if (title.includes('Agentic')) {
                    data.agentic = extractAgenticData(section);
                }
            }
        });

        // Check if we have any real data
        const hasRealData = Object.values(data).some(sectionData =>
            Object.keys(sectionData).length > 0
        );

        return hasRealData ? data : null;
    } catch (error) {
        console.error('Error extracting pipeline data:', error);
        return null;
    }
}

// Scroll to section smoothly
function scrollToSection(sectionId) {
    const element = document.getElementById(sectionId) || document.querySelector(`[data-section="${sectionId}"]`);

    if (element) {
        const headerHeight = document.querySelector('.navbar')?.offsetHeight || 0;
        const elementPosition = element.offsetTop - headerHeight - 20;

        window.scrollTo({
            top: elementPosition,
            behavior: 'smooth'
        });
    }
}

// Update active navigation link
function updateActiveNavLink(activeSection) {
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-section') === activeSection) {
            link.classList.add('active');
        }
    });
}

// Update active nav link based on scroll position
function updateActiveNavOnScroll() {
    const sections = ['overview', 'nlp', 'anomaly', 'duplicate', 'fraud', 'integrated', 'agentic'];
    const scrollPosition = window.scrollY + 100; // Offset for header

    for (const sectionId of sections) {
        const element = document.getElementById(sectionId) || document.querySelector(`[data-section="${sectionId}"]`);
        if (element) {
            const rect = element.getBoundingClientRect();
            const elementTop = rect.top + window.scrollY;
            const elementBottom = elementTop + rect.height;

            if (scrollPosition >= elementTop && scrollPosition < elementBottom) {
                updateActiveNavLink(sectionId);
                break;
            }
        }
    }
}

// Voice notification
function showVoiceNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `voice-notification ${type}`;
    notification.innerHTML = `
        <div class="voice-notification-content">
            <i class="fas fa-microphone"></i>
            <span>${message}</span>
        </div>
    `;

    document.body.appendChild(notification);

    Object.assign(notification.style, {
        position: 'fixed',
        bottom: '20px',
        left: '20px',
        background: type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' :
                   type === 'error' ? 'linear-gradient(135deg, #ef4444, #dc2626)' :
                   type === 'warning' ? 'linear-gradient(135deg, #f59e0b, #d97706)' :
                   'linear-gradient(135deg, #6366f1, #4f46e5)',
        color: 'white',
        padding: '1rem 1.5rem',
        borderRadius: '1rem',
        boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)',
        zIndex: '10001',
        transform: 'translateX(-100%)',
        transition: 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',
        maxWidth: '350px',
        backdropFilter: 'blur(10px)',
        border: '1px solid rgba(255, 255, 255, 0.2)'
    });

    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);

    // Auto remove
    setTimeout(() => {
        notification.style.transform = 'translateX(-100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 400);
    }, 4000);
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initSideNav();
    
    // Initialize charts sidebar toggle
    initChartsToggle();
});

// ========== CHARTS SIDEBAR FUNCTIONALITY ==========

// Global chart instances
let nlpChart = null;
let anomalyChart = null;
let duplicateChart = null;
let fraudChart = null;

// Extract pipeline data for charts
function extractPipelineData() {
    try {
        const sections = document.querySelectorAll('.section');
        const data = {
            nlp: { entities: 5, keywords: 15, confidence: 0.7 },
            anomaly: { totalRecords: 100, anomaliesFound: 3, confidence: 0.8 },
            duplicate: { totalRecords: 100, duplicatesFound: 2, confidence: 0.9 },
            fraud: { nodes: 50, edges: 25, clusters: 3, riskScore: 0.6 }
        };

        // This is a simplified version - in production, you'd parse actual data
        return data;
    } catch (error) {
        console.error('Error extracting pipeline data:', error);
        return null;
    }
}

// Extract NLP data for charts
function extractNLPData(section) {
    const data = {
        entities: 0,
        sentiment: 0.5,
        keywords: 0,
        confidence: 0.7
    };

    try {
        const content = section.textContent || '';
        const preElement = section.querySelector('pre');
        const preContent = preElement ? preElement.textContent : content;

        // Try to parse JSON data if available
        try {
            const jsonData = JSON.parse(preContent);
            if (jsonData && typeof jsonData === 'object') {
                // Extract from structured data
                data.entities = jsonData.entities || jsonData.entity_count || 0;
                data.sentiment = jsonData.sentiment || jsonData.sentiment_score || 0.5;
                data.keywords = jsonData.keywords ? (Array.isArray(jsonData.keywords) ? jsonData.keywords.length : 0) : 0;
                data.confidence = jsonData.confidence || jsonData.confidence_score || 0.7;
                return data;
            }
        } catch (e) {
            // Not JSON, continue with text parsing
        }

        // Extract from text content
        const entityMatches = content.match(/PERSON|ORG|GPE|DATE|MONEY|LOCATION|FACILITY/g);
        data.entities = entityMatches ? entityMatches.length : 0;

        const keywordMatches = content.match(/\b[a-z]{4,}\b/g);
        data.keywords = keywordMatches ? keywordMatches.length : 0;

        // Look for sentiment indicators
        if (content.toLowerCase().includes('positive')) data.sentiment = 0.8;
        else if (content.toLowerCase().includes('negative')) data.sentiment = -0.8;
        else data.sentiment = 0;

        // Look for confidence scores
        const confidenceMatch = content.match(/confidence[:\s]*([0-9.]+)/i);
        if (confidenceMatch) {
            data.confidence = parseFloat(confidenceMatch[1]);
        }

        return data;
    } catch (error) {
        console.warn('Error extracting NLP data:', error);
        return data;
    }
}

// Create charts with real pipeline data (only when data is available)
function createRealCharts(pipelineData) {
    if (!pipelineData) return;

    // Create NLP Radar Chart
    createNLPChart(pipelineData.nlp);

    // Create Anomaly Doughnut Chart
    createAnomalyChart(pipelineData.anomaly);

    // Create Duplicate Bar Chart
    createDuplicateChart(pipelineData.duplicate);

    // Create Fraud Line Chart
    createFraudChart(pipelineData.fraud);

    console.log('Charts created with real pipeline data:', pipelineData);
}

// Update charts with data (only called when real data is available)
function updateChartsWithData(pipelineData) {
    if (!pipelineData) return;

    // Only update charts if sidebar is visible
    const chartsSidebar = document.getElementById('chartsSidebar');
    if (!chartsSidebar || chartsSidebar.style.display === 'none') {
        console.log('Charts sidebar is hidden, skipping chart update');
        return;
    }

    try {
        createRealCharts(pipelineData);
        console.log('Charts successfully updated with pipeline data');
    } catch (error) {
        console.error('Error updating charts:', error);
    }
}

// Create NLP Analysis Chart (Radar)
function createNLPChart(data) {
    const ctx = document.getElementById('nlpChart');
    if (!ctx) return;

    // Destroy existing chart
    if (nlpChart) {
        nlpChart.destroy();
    }

    nlpChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Entities', 'Keywords', 'Sentiment', 'Confidence'],
            datasets: [{
                label: 'NLP Metrics',
                data: [
                    data.entities || 0,
                    data.keywords || 0,
                    (data.sentiment + 1) * 50 || 50, // Convert -1 to 1 range to 0-100
                    (data.confidence || 0) * 100
                ],
                backgroundColor: 'rgba(99, 102, 241, 0.2)',
                borderColor: 'rgba(99, 102, 241, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;

                            if (label === 'Entities') {
                                return `Entities: ${data.entities || 0}`;
                            } else if (label === 'Keywords') {
                                return `Keywords: ${data.keywords || 0}`;
                            } else if (label === 'Sentiment') {
                                const sentiment = data.sentiment || 0;
                                const percentage = Math.round(value);
                                return `Sentiment: ${sentiment >= 0 ? '+' : ''}${sentiment.toFixed(2)} (${percentage}%)`;
                            } else if (label === 'Confidence') {
                                const confidence = data.confidence || 0;
                                return `Confidence: ${(confidence * 100).toFixed(1)}%`;
                            }

                            return `${label}: ${value}`;
                        }
                    }
                }
            },
            scales: {
                r: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    });
}

// Create Anomaly Detection Chart (Doughnut)
function createAnomalyChart(data) {
    const ctx = document.getElementById('anomalyChart');
    if (!ctx) return;

    if (anomalyChart) {
        anomalyChart.destroy();
    }

    const totalRecords = data.totalRecords || 100;
    const anomaliesFound = data.anomaliesFound || 0;
    const normalRecords = totalRecords - anomaliesFound;
    const anomalyPercentage = totalRecords > 0 ? ((anomaliesFound / totalRecords) * 100) : 0;

    anomalyChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Normal', 'Anomalous'],
            datasets: [{
                data: [normalRecords, anomaliesFound],
                backgroundColor: [
                    'rgba(16, 185, 129, 0.8)',
                    'rgba(239, 68, 68, 0.8)'
                ],
                borderColor: [
                    'rgba(16, 185, 129, 1)',
                    'rgba(239, 68, 68, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;

                            if (label === 'Normal') {
                                const percentage = totalRecords > 0 ? ((value / totalRecords) * 100).toFixed(1) : 0;
                                return `Normal: ${value} records (${percentage}%)`;
                            } else if (label === 'Anomalous') {
                                const percentage = anomalyPercentage.toFixed(1);
                                return `Anomalous: ${value} records (${percentage}%)`;
                            }

                            return `${label}: ${value}`;
                        },
                        afterLabel: function(context) {
                            if (context.label === 'Anomalous') {
                                return `Total Records: ${totalRecords}\nConfidence: ${(data.confidence || 0).toFixed(1)}%`;
                            }
                            return '';
                        }
                    }
                }
            }
        }
    });
}

// Create Duplicate Detection Chart (Bar)
function createDuplicateChart(data) {
    const ctx = document.getElementById('duplicateChart');
    if (!ctx) return;

    if (duplicateChart) {
        duplicateChart.destroy();
    }

    const totalRecords = data.totalRecords || 100;
    const duplicatesFound = data.duplicatesFound || 0;
    const groups = data.groups || 0;
    const duplicatePercentage = totalRecords > 0 ? ((duplicatesFound / totalRecords) * 100) : 0;

    duplicateChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Records', 'Duplicates', 'Groups'],
            datasets: [{
                label: 'Count',
                data: [totalRecords, duplicatesFound, groups],
                backgroundColor: [
                    'rgba(99, 102, 241, 0.6)',
                    'rgba(245, 158, 11, 0.6)',
                    'rgba(16, 185, 129, 0.6)'
                ],
                borderColor: [
                    'rgba(99, 102, 241, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(16, 185, 129, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString(); // Format large numbers
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;

                            if (label === 'Records') {
                                return `Total Records: ${value.toLocaleString()}`;
                            } else if (label === 'Duplicates') {
                                const percentage = duplicatePercentage.toFixed(1);
                                return `Duplicates: ${value} (${percentage}%)`;
                            } else if (label === 'Groups') {
                                return `Duplicate Groups: ${value}`;
                            }

                            return `${label}: ${value}`;
                        },
                        afterLabel: function(context) {
                            if (context.label === 'Duplicates') {
                                return `Confidence: ${(data.confidence || 0).toFixed(1)}%`;
                            }
                            return '';
                        }
                    }
                }
            }
        }
    });
}

// Create Fraud Network Chart (Line)
function createFraudChart(data) {
    const ctx = document.getElementById('fraudChart');
    if (!ctx) return;

    if (fraudChart) {
        fraudChart.destroy();
    }

    const nodes = data.nodes || 50;
    const edges = data.edges || 25;
    const clusters = data.clusters || 3;
    const riskScore = data.riskScore || 0.6;
    const riskPercentage = (riskScore * 100);

    fraudChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Nodes', 'Edges', 'Clusters', 'Risk Score'],
            datasets: [{
                label: 'Network Metrics',
                data: [nodes, edges, clusters, riskPercentage],
                borderColor: 'rgba(139, 92, 246, 1)',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: 'rgba(139, 92, 246, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(139, 92, 246, 1)',
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value, index) {
                            // Different formatting for risk score vs counts
                            if (index === 3) { // Risk Score is the 4th item (index 3)
                                return value + '%';
                            }
                            return value.toLocaleString();
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const index = context.dataIndex;

                            if (label === 'Nodes') {
                                return `Network Nodes: ${value.toLocaleString()}`;
                            } else if (label === 'Edges') {
                                return `Network Edges: ${value.toLocaleString()}`;
                            } else if (label === 'Clusters') {
                                return `Fraud Clusters: ${value}`;
                            } else if (label === 'Risk Score') {
                                return `Risk Score: ${value.toFixed(1)}%`;
                            }

                            return `${label}: ${value}`;
                        },
                        afterLabel: function(context) {
                            const label = context.label || '';
                            if (label === 'Risk Score') {
                                const centrality = data.centrality || 0;
                                return `Network Centrality: ${(centrality * 100).toFixed(1)}%`;
                            }
                            return '';
                        }
                    }
                }
            }
        }
    });
}

// Initialize charts when sidebar becomes visible
function initChartsWhenVisible() {
    const chartsSidebar = document.getElementById('chartsSidebar');
    if (chartsSidebar && chartsSidebar.style.display !== 'none') {
        // Check if we have real pipeline data available
        const pipelineData = extractPipelineData();
        if (pipelineData) {
            createRealCharts(pipelineData);
        }
    }
}

// ========== CHARTS SIDEBAR TOGGLE FUNCTIONALITY ==========
function initChartsToggle() {
    const chartsToggle = document.getElementById('chartsToggle');
    const chartsSidebar = document.getElementById('chartsSidebar');
    
    if (chartsToggle && chartsSidebar) {
        chartsToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const isVisible = chartsSidebar.style.display !== 'none';
            
            if (isVisible) {
                // Hide sidebar
                chartsSidebar.style.display = 'none';
                this.innerHTML = '<i class="fas fa-chart-bar"></i>';
            } else {
                // Show sidebar
                chartsSidebar.style.display = 'block';
                this.innerHTML = '<i class="fas fa-times"></i>';
                initChartsWhenVisible();
            }
        });
    }
}

// Stop voice recognition when page unloads
window.addEventListener('beforeunload', () => {
    if (voiceRecognition && isVoiceActive) {
        voiceRecognition.stop();
    }
});
</script>
    <!-- Floating background elements -->
    <!-- Background Animation Elements -->
    <div class="floating-bg"></div>
    <div class="floating one"></div>
    <div class="floating two"></div>
    <div class="floating three"></div>

    <!-- Charts Sidebar Toggle Button - Always Visible -->
    <button class="charts-toggle" id="chartsToggle">
        <i class="fas fa-chart-bar"></i>
    </button>

    <!-- Charts Sidebar - Initially Hidden -->
    <div class="charts-sidebar" id="chartsSidebar" style="display: none;">
        <div class="charts-content">
            <!-- NLP Analysis Chart -->
            <div class="chart-section">
                <h4><i class="fas fa-brain"></i> NLP Analysis</h4>
                <canvas id="nlpChart" width="250" height="200"></canvas>
            </div>

            <!-- Anomaly Detection Chart -->
            <div class="chart-section">
                <h4><i class="fas fa-exclamation-triangle"></i> Anomaly Detection</h4>
                <canvas id="anomalyChart" width="250" height="200"></canvas>
            </div>

            <!-- Duplicate Detection Chart -->
            <div class="chart-section">
                <h4><i class="fas fa-copy"></i> Duplicate Detection</h4>
                <canvas id="duplicateChart" width="250" height="200"></canvas>
            </div>

            <!-- Fraud Network Chart -->
            <div class="chart-section">
                <h4><i class="fas fa-project-diagram"></i> Fraud Network</h4>
                <canvas id="fraudChart" width="250" height="200"></canvas>
            </div>
        </div>
    </div>
</body>

<!-- Add this script to handle animations after page load -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add 'animate' class to body to start animations
    document.body.classList.add('animate');
    
    // Ensure animations are hardware-accelerated
    const animateElements = document.querySelectorAll('.floating, .floating-bg');
    animateElements.forEach(el => {
        el.style.willChange = 'transform, opacity';
    });
});
</script>
</html>